@model GenerateurDFUSafir.Models.GestionTraitementOFs
@{
    ViewBag.Title = "IndexOFOperateur";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/IndexOFOperateur.css" rel="stylesheet" />
<meta charset="UTF-8" />

<div id="root"></div>

@{
    var reactFiles = System.IO.Directory
        .EnumerateFiles(Server.MapPath("~/Scripts/react/assets"), "index-*.js")
        .Select(System.IO.Path.GetFileName)
        .ToList();
}

@if (reactFiles.Any())
{
    <script type="module" src="~/Scripts/react/assets/@reactFiles.First()"></script>
}
else
{
    <p>Erreur : Aucun fichier React trouvé dans ~/Scripts/react/assets/</p>
}

@using Newtonsoft.Json
<script>
   @{
        // Définir le type anonyme une seule fois pour éviter les incompatibilités
        var emptyOperatorList = new[] { new { ID = 0L, Photo = "", Nom = "", Prenom = "", isValidPasswd = false } }.Take(0).ToList();
        var operators = Model.DataOperateurs != null
            ? Model.DataOperateurs.Select(op => new
            {
                op.ID,
                op.Photo,
                op.Nom,
                op.Prenom,
                op.isValidPasswd
            }).ToList()
            : emptyOperatorList;
    }
    window.reactData = @Html.Raw(JsonConvert.SerializeObject(new
    {
        ListOperateur = operators
    }));
</script>