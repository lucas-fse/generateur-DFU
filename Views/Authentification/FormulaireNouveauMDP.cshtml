@model GenerateurDFUSafir.Models.DataOperateurProd
@{
    ViewBag.Title = "FormulaireNouveauMDP";
    Layout = "~/Views/Shared/_Layout.cshtml";
    <link href="~/Content/ConnexionOperateur.css" rel="stylesheet" />
}

<body onload="init()">
    <div id="fondTransparent"></div>
    <div id="login-container">
        <div id="introduction">
            <h2 id="title">Recréer votre Mot de Passe</h2>
            <p>Veuillez redéfinir votre mot de passe de <strong>4 chiffres</strong> @Model.Prenom :</p>
        </div>
        <div id="digi-container">
            <div id="profil">
                <img src="@Model.Photo" id="photo-profil" />
                <div class="nom-op">
                    <strong>@Model.Nom</strong> @Model.Prenom
                </div>
            </div>
            <form method="post" action="@Url.Action("ReinitialiserMotDePasse", "Production")" id="login-form">
                <input type="hidden" name="id" value="@Model.ID" />
                <input type="hidden" name="token" value="@ViewBag.Token" />
                <input type="password" id="motdepasse" name="nouveauMotDePasse" readonly maxlength="4" minlength="4" pattern="\d{4}" required />

                <div id="digicode">
                    @for (int i = 1; i <= 9; i++)
                    {
                        <button type="button" onclick="ajouterChiffre('@i')">@i</button>
                    }
                    <div id="digicode">
                        @for (int i = 1; i <= 9; i++)
                        {
                            <button type="button" onclick="ajouterChiffre('@i')">@i</button>
                        }
                        <button type="button" onclick="supprimerDernier()">⌫</button>
                        <button type="button" onclick="ajouterChiffre('0')">0</button>
                        <button type="button" onclick="validerFormulaire()">✔️</button>
                    </div>

                </div>
            </form>

            <div id="erreur-mdp" class="alert alert-danger" style="display:none; margin-top:10px;"></div>
        </div>
        @if (ViewBag.Erreur != null)
        {
            <div class="alert alert-danger">@ViewBag.Erreur</div>
        }
    </div>
</body>

<script>
    function ajouterChiffre(c) {
        const input = document.getElementById("motdepasse");
        if (input.value.length < 4) {
            input.value += c;
        }
    }

    function supprimerDernier() {
        const input = document.getElementById("motdepasse");
        input.value = input.value.slice(0, -1);
    }

    function validerFormulaire() {
        const input = document.getElementById("motdepasse");
        const messageErreur = document.getElementById("erreur-mdp");

        if (/^\d{4}$/.test(input.value)) {
            messageErreur.style.display = "none";
            document.getElementById("login-form").submit();
        } else {
            messageErreur.textContent = "Le mot de passe doit contenir exactement 4 chiffres.";
            messageErreur.style.display = "block";
        }
    }
</script>
